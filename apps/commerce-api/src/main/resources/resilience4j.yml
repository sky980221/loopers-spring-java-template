resilience4j:
  circuitbreaker:
    configs:
      default:
        sliding-window-size: 10 # 가장 최근 10번 호출에 대해서
        failure-rate-threshold: 50       # 실패율이 50% 넘으면 Open
        wait-duration-in-open-state: 10s # Open 상태 유지 시간
        permitted-number-of-calls-in-half-open-state: 2 #half open으로 전환되었을 때 몇개 흘려보낼거야?
        slow-call-duration-threshold: 2s # 2초가 넘어가면, 좀 느린거 같은데? 최근 50%에 대해서, 문제로 판단한다.
        slow-call-rate-threshold: 50       # 느린 호출이 50% 넘으면 Open
        record-exceptions:
          - feign.FeignException
          - java.net.SocketTimeoutException
          - java.io.IOException
    instances:
      pgCircuit:
        base-config: default

  retry:
    configs:
      default:
        max-attempts: 3                        # 최대 3번 시도 (초기 호출 포함)
        wait-duration: 500ms                   # 재시도 간격
        retry-exceptions:
          - feign.RetryableException
          - feign.FeignException
          - java.net.SocketTimeoutException
          - java.lang.Exception                # 모든 예외에 대해 재시도 (ignore-exceptions 제외)
        ignore-exceptions:
          - com.loopers.support.error.CoreException